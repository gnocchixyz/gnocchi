language: python
sudo: required

services:
  - docker

cache:
  directories:
    - ~/.cache/pip
env:
  - TARGETS: pep8,docs,docs-gnocchi.xyz,py27-mysql-ceph-upgrade-from-3.1,py35-postgresql-file-upgrade-from-3.1
  - TARGETS: py27
  - TARGETS: py35

before_script:
  # Travis We need to fetch all tags/branches for documentation target
  - case $TARGETS in
      *docs*)
        git config --add remote.origin.fetch +refs/heads/stable/*:refs/remotes/origin/stable/*;
        git fetch --unshallow --tags;
        ;;
    esac
script:
  - docker run -v ~/.cache/pip:/home/tester/.cache/pip -v $(pwd):/home/tester/src gnocchixyz/ci-tools:latest tox -e ${TARGETS}

notifications:
  email: false
  irc:
    on_success: change
    on_failure: always
    skip_join: true
    channels:
      - "irc.freenode.org#gnocchi"
